# UdpFileTransfer

## 概要

UDPを使用してファイル送受信を行うソフトウェアです。

通常、通信可能な方向が片方向のみの
特殊な環境（例えば、衛星通信やネットワーク機器によるフィルタリング）においては、
TCPセッションを確立できないためファイル転送は困難です。

本ソフトウェアであれば、フロー制御や再送制御をオペレータが手動で行うことができるため、
片方向の通信のみでもファイルを転送が可能です。


## 仕組み

本ソフトウェアによるファイル送受信は、メタデータ送信フェーズと本体データ送信フェーズにより、
実現されます。


### メタデータ送信フェーズ

1. 受信側は、初めに、ファイル名、ファイルサイズ、送信単位等のメタデータの到着を待ちます。
1. 送信側は、ファイル名、ファイルサイズ、送信単位等のメタデータを受信側に送信します。
1. 受信側は、メタデータを受け取ると、本体データ送信フェーズに移行します。

UDPを使用するため、メタデータを1回の送信で到達させられるとは限りません。

* メタデータが届かない状態で本体データ到着しても無視します。
* 受信側でメタデータの到達がされない場合、受信側は送信側に依頼し、
再度メタデータを送信してもらう必要があります。
* メタデータは1つ以上到達すれば複数到達しても問題ないことから、
送信側は到達率をあげるために、あらかじめ複数回メタデータを送っても問題ありません。


### 本体データ送信フェーズ

1. 送信側は、ファイルをある程度の単位（数百バイト）に区切り、
データを何番目のデータであるかを表すシーケンス番号とともに、
UDPダイアグラムによって送信します。
1. 受信側は、送信側から送られてきたシーケンス番号とデータを受信したら、
ファイルの適切な位置に書き込みます。
すべてのシーケンス番号がそろうまで受信を続けます。
1. 受信側は、すべてのシーケンス番号分のデータがそろったら、終了します。

UDPを使用するため、各データを1回の送信で到達させられるとは限りません。
* 受信側は、メタデータをもとに全データ数と各データのサイズを把握します。
* 受信側でそろわないデータがある場合、そのシーケンス番号を送信側に連絡して再送してもらう必要があります。
* 各データは1つ以上到達すれば複数到達しても問題ないことから、
送信側は到達率をあげるために、あらかじめ複数回データを送っても問題ありません。
* 送信側では、受信側の状態（どのシーケンス番号が到達したか、あるいはすべてのデータが到達したか等）
を検知できません。


## 使用方法

受信側において受信モードで起動させてから、送信側において送信モードで起動します。

多くの場合、起動後に送信側で空改行を数回打鍵すると、受信側が終了し、
ファイル転送が完了します。

受信側が終了しない（到達しないデータがある）場合は、以下を参考にオペレーションを実施してください。


### 受信側コマンド

    java -jar UdpFileTransfer.jar -m recv -f sample/recv.txt

    missing
    到達していないデータのシーケンス番号を表示します。

    file xyz/abc.txt
    受信したデータを書き込むファイルパスをxyz/abc.txtに変更します。

    quit
    終了します。


### 送信側コマンド

    java -jar UdpFileTransfer.jar -m send -f sample/send.txt

    all
    メタデータを2回送信したのち、すべての本体データを送信します。空改行はallと同じ意味となります。

    meta
    メタデータを送信します。

    4352
    シーケンス番号4352のデータを送信します。

    #20
    各データの送信間隔を20msに設定します。

    quit
    終了します。



### コマンドライン引数

下記のようにヘルプを表示させ、確認してください。

    java -jar UdpFileTransfer.jar
